C51 COMPILER V9.60.0.0   KEYPAD_INTERFACE                                                  03/07/2021 02:48:31 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE KEYPAD_INTERFACE
OBJECT MODULE PLACED IN keypad_interface.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE keypad_interface.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include<reg52.h>
   2          #include<stdio.h>
   3          #include<string.h>
   4          #include "LCD_8_bit.h"
   5          
   6          #define keyport P1
   7          #define dac P0 //Port P0 address
   8          sbit RS     = P3^3;
   9          sbit RW     = P3^4;
  10          sbit ENABLE = P3^5;
  11          unsigned char keypad[4][4] = {{'7','8','9','/'},
  12                                        {'4','5','6','x'},
  13                                        {'1','2','3','-'},
  14                                        {' ','0','=','+'} };
  15          
  16          unsigned char colloc, rowloc;
  17          
  18          
  19          unsigned char key_detect()
  20          {
  21   1          keyport=0xF0;             
  22   1            do
  23   1            {
  24   2              keyport = 0xF0;       
  25   2              colloc = keyport;
  26   2              colloc&= 0xF0;        
  27   2          }while(colloc != 0xF0);   
  28   1            do
  29   1            {
  30   2              do
  31   2              {
  32   3                delay(20);                  /* 20ms key debounce time */
  33   3                colloc = (keyport & 0xF0);  /* read status of column */
  34   3              }while(colloc == 0xF0);       /* check for any key press */
  35   2          
  36   2              delay(1);
  37   2              colloc = (keyport & 0xF0);
  38   2            }while(colloc == 0xF0);
  39   1      while(1)
  40   1        {
  41   2          /* now check for rows */
  42   2            keyport= 0xFE;                  /* check for pressed key in 1st row */
  43   2            colloc = (keyport & 0xF0);
  44   2            if(colloc != 0xF0)
  45   2            {
  46   3              rowloc = 0;
  47   3              break;
  48   3            }
  49   2      
  50   2            keyport = 0xFD;                 /* check for pressed key in 2nd row */
  51   2            colloc = (keyport & 0xF0);
  52   2            if(colloc != 0xF0)
  53   2            {
  54   3              rowloc = 1;
  55   3              break;
C51 COMPILER V9.60.0.0   KEYPAD_INTERFACE                                                  03/07/2021 02:48:31 PAGE 2   

  56   3            }
  57   2            
  58   2            keyport = 0xFB;                 /* check for pressed key in 3rd row */
  59   2            colloc = (keyport & 0xF0);
  60   2            if(colloc != 0xF0)
  61   2            {
  62   3              rowloc = 2;
  63   3              break;
  64   3            }
  65   2      
  66   2            keyport = 0xF7;                 /* check for pressed key in 4th row */
  67   2            colloc = (keyport & 0xF0);
  68   2            if(colloc != 0xF0)
  69   2            {
  70   3              rowloc = 3;
  71   3              break;
  72   3            } 
  73   2        }
  74   1        
  75   1          if(colloc == 0xE0)
  76   1          {
  77   2              return(keypad[rowloc][0]);
  78   2          }   
  79   1          else if(colloc == 0xD0)
  80   1          {
  81   2            return(keypad[rowloc][1]);
  82   2          } 
  83   1          else if(colloc == 0xB0)
  84   1          {
  85   2            return(keypad[rowloc][2]);
  86   2          } 
  87   1          else
  88   1          {
  89   2            return(keypad[rowloc][3]);
  90   2          } 
  91   1      }
  92          
  93          
  94          int main(void)
  95          {
  96   1      int dacval = 128;
  97   1        dac = dacval;
  98   1        LCD_Init();
  99   1        LCD_String_xy(1,0,"Short circuit");
 100   1        LCD_String_xy(2,0,"Designathon");
 101   1      delay(100);
 102   1      LCD_Command(0x01);
 103   1        LCD_String_xy(1,0,"8: inc , 2: dec");
 104   1      
 105   1        while(1){
 106   2          LCD_Command(0xc0);
 107   2          if(key_detect()== '8'){
 108   3              LCD_Command(0x01);
 109   3            LCD_String_xy(2,0,"Incremented 10%");
 110   3            dacval += 10 ;
 111   3          }
 112   2          else if(key_detect()== '2'){
 113   3              LCD_Command(0x01);
 114   3            LCD_String_xy(2,0,"Decremented 10%");
 115   3            dacval -= 10;
 116   3          }
 117   2          else{
C51 COMPILER V9.60.0.0   KEYPAD_INTERFACE                                                  03/07/2021 02:48:31 PAGE 3   

 118   3      LCD_String_xy(2,0,"Short circuit");
 119   3      
 120   3        }
 121   2          if(dacval >255) dacval = 0;
 122   2      dac = dacval;   
 123   2      }}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    360    ----
   CONSTANT SIZE    =     74    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
